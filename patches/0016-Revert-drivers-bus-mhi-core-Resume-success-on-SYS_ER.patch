From cbf045169b6dc963b0525f1e7d91555adf93ece2 Mon Sep 17 00:00:00 2001
From: Daniele Palmas <dnlplm@gmail.com>
Date: Fri, 14 Oct 2022 11:24:31 +0200
Subject: [PATCH 16/19] Revert "drivers: bus: mhi: core: Resume success on
 SYS_ERR"

This reverts commit e962e190197355aa48329f245e37a6b2135fc26a.

Signed-off-by: Daniele Palmas <dnlplm@gmail.com>
---
 drivers/bus/mhi/host/pm.c | 16 ----------------
 1 file changed, 16 deletions(-)

diff --git a/drivers/bus/mhi/host/pm.c b/drivers/bus/mhi/host/pm.c
index 51ceb1e4b149..f7bf23b3b624 100644
--- a/drivers/bus/mhi/host/pm.c
+++ b/drivers/bus/mhi/host/pm.c
@@ -968,22 +968,6 @@ static int __mhi_pm_resume(struct mhi_controller *mhi_cntrl, bool force)
 	if (MHI_PM_IN_ERROR_STATE(mhi_cntrl->pm_state))
 		return -EIO;
 
-	if (mhi_get_mhi_state(mhi_cntrl) == MHI_STATE_SYS_ERR) {
-		/* If we are in SYS_ERR state, let MHI stack manages the error
-		 * and resume successfully.
-		 */
-		dev_warn(dev, "Entered error while suspended\n");
-
-		write_lock_irq(&mhi_cntrl->pm_lock);
-		cur_state = mhi_tryset_pm_state(mhi_cntrl, MHI_PM_SYS_ERR_DETECT);
-		write_unlock_irq(&mhi_cntrl->pm_lock);
-
-		if (cur_state == MHI_PM_SYS_ERR_DETECT) {
-			mhi_pm_sys_err_handler(mhi_cntrl);
-			return 0;
-		}
-	}
-
 	if (mhi_get_mhi_state(mhi_cntrl) != MHI_STATE_M3) {
 		dev_warn(dev, "Resuming from non M3 state (%s)\n",
 			 mhi_state_str(mhi_get_mhi_state(mhi_cntrl)));
-- 
2.37.1

